# –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Code.gs

## –í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ
–í—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç–µ–∫—Å—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ—Ç–∫–µ (`main`). –í —Ä–∞–±–æ—á–µ–π –≤–µ—Ç–∫–µ `refactor-add-subscription-helpers-remove-forwards` —ç—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤–ø–µ—Ä–≤—ã–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º.

## –ß–∞—Å—Ç—å 1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥) ‚úÖ

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã helper-—Ñ—É–Ω–∫—Ü–∏–∏:
1. `isUserCurrentlyRestricted(chatId, userId)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
2. `buildSubscriptionKeyboard(config, userId)` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ–¥–ø–∏—Å–∫–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏

### ‚úÖ –ó–∞–º–µ–Ω—ë–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥:
- **handleMessage()** - –ø—Ä–æ–≤–µ—Ä–∫–∞ restrict-—Å—Ç–∞—Ç—É—Å–∞ ‚Üí `isUserCurrentlyRestricted()`
- **handleMessage()** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ‚Üí `buildSubscriptionKeyboard()`
- **handleCallbackQuery()** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ‚Üí `buildSubscriptionKeyboard()`
- **applyProgressiveMute()** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ‚Üí `buildSubscriptionKeyboard()`

### ‚úÖ –£–¥–∞–ª–µ–Ω –ø—É–Ω–∫—Ç –º–µ–Ω—é:
- –£–¥–∞–ª–µ–Ω `'üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã', 'runTestsFromMenu'`

## –ß–∞—Å—Ç—å 2: –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–ø–æ—Å—Ç–æ–≤ ‚úÖ

### ‚úÖ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ main):
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ—Å—Ç–æ–≤: `message.forward_from || message.forward_from_chat`
- –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–ø–æ—Å—Ç–æ–≤ –∏–∑ –Ω–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è: –∞–¥–º–∏–Ω—ã, whitelist, target_channel_id

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π –¥–ª—è —Ä–µ–ø–æ—Å—Ç–æ–≤:
- **1-2 –Ω–∞—Ä—É—à–µ–Ω–∏–µ**: —É–¥–∞–ª–µ–Ω–∏–µ + –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- **3+ –Ω–∞—Ä—É—à–µ–Ω–∏–π**: —É–¥–∞–ª–µ–Ω–∏–µ + –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –º—É—Ç
- –°—á—ë—Ç—á–∏–∫: `forward_violations_${userId}`

### ‚úÖ –ù–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ main):
- `forward_warning_text`: "–≤ —ç—Ç–æ–º —á–∞—Ç–µ –∑–∞–ø—Ä–µ—â–µ–Ω—ã —Ä–µ–ø–æ—Å—Ç—ã..."
- `forward_mute_text`: "–≤—ã –±—ã–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –Ω–∞ {duration} –º–∏–Ω—É—Ç..."

### ‚úÖ –ù–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ main):
- `forward_check_enabled`: TRUE/FALSE
- `forward_violation_limit`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–æ—Å—Ç–æ–≤ –ø–µ—Ä–µ–¥ –º—É—Ç–æ–º

### ‚úÖ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ main):
- `applyProgressiveMuteForForwards()` - –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –º—É—Ç –∑–∞ —Ä–µ–ø–æ—Å—Ç—ã

## –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `IGNORED_USER_IDS = ['136817688', '777000']`
- –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞
- –í—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: 1909 ‚Üí 2097 —Å—Ç—Ä–æ–∫ (+188 —Å—Ç—Ä–æ–∫)
- **–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó –≤—ã–ø–æ–ª–Ω–µ–Ω—ã**